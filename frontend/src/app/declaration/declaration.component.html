<ng-container *ngIf="showContent; else notStarted">

  <div class="container">

    <h3>Data Declaration</h3>
    <div class="data-import-controls">
      <input type="file" (change)="onFilesSelected($event)" multiple>
      <div>
        <input type="checkbox" [(ngModel)]="firstLineIsNotHeader" id="firstLineHeader">
        <label for="firstLineHeader">First line is not header</label>
      </div>
      <div *ngIf="isExcelFile && hasMultipleSheets">
        <input type="checkbox" [(ngModel)]="firstSheetHasNotDataset" id="firstSheetDataset">
        <label for="firstSheetDataset">First sheet has not the dataset</label>
      </div>
      <div *ngIf="selectedFiles[0] && selectedFiles[0].name.toLowerCase().endsWith('.csv')" class="column-separator-container">
        <label for="columnSeparator" class="column-separator-label">Column Separator</label>
        <select id="columnSeparator" [(ngModel)]="columnSeparator" class="column-separator-select">
          <option value="semicolon">Semicolon</option>
          <option value="comma">Comma</option>
          <option value="tab">Tab</option>
          <option value="space">Space</option>
        </select>
      </div>
      <div *ngIf="selectedFiles.length > 1">
        <mat-checkbox [(ngModel)]="mergeColumnWise">Merge column-wise</mat-checkbox>
      </div>
      <button class="import-data-btn" (click)="onUpload()">Import Data</button>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
      <button *ngIf="showUseExistingButton" class="use-existing-btn" (click)="useExistingFile()">Use Existing File</button>
    </div>

    <div *ngIf="previewData" class="preview-container">
      <h3>Data Preview</h3>
      <p *ngIf="previewData.note" class="preview-note">{{ previewData.note }}</p>
      <p>Total Rows: {{ previewData.total_rows }}</p>
      <p>Total Columns: {{ previewData.total_columns }}</p>
      <div class="table-container">
        <table class="preview-table">
          <thead>
            <tr>
              <th *ngFor="let column of previewData.columns">{{ column }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of previewData.top_rows">
              <td *ngFor="let column of previewData.columns">{{ row[column] }}</td>
            </tr>
            <tr class="separator-row">
              <td [attr.colspan]="previewData.columns.length">...</td>
            </tr>
            <tr *ngFor="let row of previewData.bottom_rows">
              <td *ngFor="let column of previewData.columns">{{ row[column] }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="showDataDictionaryCollection">
      <h3>Dictionary Declaration</h3>
      <div class="dictionary-actions">
        <div class="dictionary-upload">
          <input type="file" (change)="onDictionaryFileSelected($event)">
          <button (click)="onGenerateDataDictionary(true)">Generate Data Dictionary</button>
        </div>
        <button (click)="onGenerateDataDictionary(false)">Generate without Uploading</button>
      </div>
    </div>

    <div *ngIf="dataDictionary.length > 0" class="data-dictionary-container">
      <h3>Data Dictionary</h3>
      <div class="table-container">
        <table class="data-dictionary-table">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Data Type</th>
              <th># of Unique Values</th>
              <th>Level of Measurement</th>
              <th>Missing Ratio (%)</th>
              <th>Mode Ratio (%)</th>
              <th>Model Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of dataDictionary">
              <td><a href="javascript:void(0)" (click)="openFeatureCard(item)">{{item.Feature_Name}}</a></td>
              <td>{{item.Feature_Description || 'N/A'}}</td>
              <td>{{item.Data_Type}}</td>
              <td>{{item['#_of_Unique_Value']}}</td>
              <td>{{item.Level_of_Measurement}}</td>
              <td>{{item.Missing_Ratio}}</td>
              <td>{{item.Mode_Ratio}}</td>
              <td>{{item.Model_Usage_YN}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>

</ng-container>

<div class="next-button-container" *ngIf="dataDictionary.length > 0 && !preprocessingInitiated">
  <button 
    class="next-button" 
    [disabled]="!dataDictionary.length" 
    (click)="goToPreprocessing()">
    <span class="next-icon">&#9654;</span> Preprocessing
  </button>
</div>

<ng-template #notStarted>
  <div class="not-started-message" *ngIf="!showContent">
    Please select a pipeline and click 'Start' to begin the model development process.
  </div>
</ng-template>